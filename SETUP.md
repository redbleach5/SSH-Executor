# Инструкция по установке и настройке

## Содержание

1. [Требования](#требования)
2. [Установка зависимостей](#установка-зависимостей)
3. [Настройка окружения](#настройка-окружения)
4. [Запуск приложения](#запуск-приложения)
5. [Сборка для продакшена](#сборка-для-продакшена)
6. [Решение проблем](#решение-проблем)

## Требования

### Обязательные требования

- **Windows 10/11** (64-bit)
- **Node.js** версии 18.0.0 или выше
- **npm** версии 9.0.0 или выше (обычно устанавливается вместе с Node.js)
- **Rust** версии 1.70.0 или выше
- **Cargo** (устанавливается вместе с Rust)
- **Git** для загрузки зависимостей

### Рекомендуемые требования

- **Visual Studio Build Tools** или **Visual Studio Community** (для компиляции Rust на Windows)
- Минимум **8 GB RAM** для комфортной разработки
- **10 GB** свободного места на диске

## Установка зависимостей

### 1. Установка Node.js

1. Скачайте Node.js с официального сайта: https://nodejs.org/
2. Установите LTS версию (рекомендуется 18.x или выше)
3. Проверьте установку:
   ```bash
   node --version
   npm --version
   ```

### 2. Установка Rust

1. Скачайте установщик с официального сайта: https://www.rust-lang.org/tools/install
2. Запустите установщик и следуйте инструкциям
3. После установки перезапустите терминал
4. Проверьте установку:
   ```bash
   rustc --version
   cargo --version
   ```

### 3. Установка Visual Studio Build Tools (для Windows)

1. Скачайте Build Tools с сайта Microsoft: https://visualstudio.microsoft.com/downloads/
2. Установите "Desktop development with C++" workload
3. Это необходимо для компиляции нативных зависимостей Rust

### 4. Установка зависимостей проекта

```bash
# Перейдите в директорию проекта
cd "e:\SSH Executor"

# Установите Node.js зависимости
npm install
```

## Настройка окружения

### Настройка Cargo для работы с SSL

Если при сборке возникают проблемы с SSL сертификатами, выполните:

```bash
npm run fix-cargo-ssl
```

Этот скрипт настроит Cargo для использования Git CLI вместо встроенного HTTP клиента, что решает большинство проблем с SSL на Windows.

### Проверка конфигурации

Проверьте файл `src-tauri/.cargo/config.toml`. Он должен содержать:

```toml
[net]
git-fetch-with-cli = true
retry = 10

[registries.crates-io]
protocol = "git"
```

## Запуск приложения

### Режим разработки

```bash
# Запуск приложения в режиме разработки
npm run tauri:dev
```

Этот скрипт:
1. Запускает Vite dev сервер на порту 1420
2. Компилирует Rust код
3. Запускает Tauri приложение

### Альтернативный способ

Если нужно запустить только frontend:

```bash
npm run dev
```

Или только backend (для отладки):

```bash
cd src-tauri
cargo build
cargo run
```

## Сборка для продакшена

### Сборка приложения

```bash
# Сборка для текущей платформы
npm run tauri:build
```

Собранное приложение будет находиться в:
- `src-tauri/target/release/ssh-executor.exe` (исполняемый файл)
- `src-tauri/target/release/bundle/` (установочные пакеты)

### Типы сборок

Tauri автоматически создает:
- **MSI установщик** для Windows
- **Портативный .exe** файл

### Оптимизация сборки

Для уменьшения размера приложения:

1. Убедитесь, что используете release сборку:
   ```bash
   npm run tauri:build -- --release
   ```

2. Проверьте настройки в `tauri.conf.json`:
   - Отключите ненужные функции Tauri
   - Настройте иконки приложения

## Решение проблем

### Проблема: Ошибки SSL при сборке

**Симптомы:**
```
error: failed to fetch `https://...`
SSL connect error
```

**Решение:**
1. Запустите `npm run fix-cargo-ssl`
2. Обновите сертификаты Windows через Windows Update
3. Проверьте настройки прокси (если используется)

Подробнее см. [docs/SSL_CONFIGURATION_SECURITY.md](./docs/SSL_CONFIGURATION_SECURITY.md)

### Проблема: Порт 1420 уже занят

**Симптомы:**
```
Error: listen EADDRINUSE: address already in use :::1420
```

**Решение:**
```bash
# Убейте процесс на порту 1420
npm run kill-port
```

Или вручную:
```powershell
# Найдите процесс
netstat -ano | findstr :1420

# Убейте процесс (замените PID на найденный)
taskkill /PID <PID> /F
```

### Проблема: Ошибки компиляции Rust

**Симптомы:**
```
error: linker `link.exe` not found
```

**Решение:**
1. Установите Visual Studio Build Tools
2. Убедитесь, что установлен "Desktop development with C++" workload
3. Перезапустите терминал

### Проблема: Медленная сборка

**Решения:**
1. Используйте release сборку только для финальной версии:
   ```bash
   # Для разработки используйте dev сборку
   npm run tauri:dev
   ```

2. Очистите кэш Cargo:
   ```bash
   cd src-tauri
   cargo clean
   ```

3. Используйте параллельную сборку (по умолчанию включена)

### Проблема: Зависимости не устанавливаются

**Решение:**
1. Очистите кэш npm:
   ```bash
   npm cache clean --force
   ```

2. Удалите `node_modules` и `package-lock.json`:
   ```bash
   rm -rf node_modules package-lock.json
   npm install
   ```

3. Для Cargo:
   ```bash
   cd src-tauri
   cargo clean
   cargo update
   ```

### Проблема: Приложение не запускается

**Проверьте:**
1. Все зависимости установлены: `npm install`
2. Rust установлен: `rustc --version`
3. Нет ошибок в консоли при запуске
4. Проверьте логи в консоли разработчика (F12 в приложении)

## Дополнительные настройки

### Настройка иконок

```bash
# Генерация иконок из SVG
npm run generate-icons

# Создание ICO файла
npm run create-ico

# Или все сразу
npm run setup-icons
```

### Настройка переменных окружения

Создайте файл `.env` в корне проекта для настройки окружения:

```env
# Порт для dev сервера
VITE_PORT=1420

# Режим отладки
RUST_LOG=debug
```

## Следующие шаги

После успешной установки:

1. Прочитайте [README.md](./README.md) для понимания возможностей приложения
2. Изучите [PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md) для понимания структуры кода
3. Ознакомьтесь с [SECURITY.md](./SECURITY.md) для понимания функций безопасности

## Поддержка

Если проблемы не решены:

1. Проверьте [TROUBLESHOOTING.md](./TROUBLESHOOTING.md) (если существует)
2. Создайте issue в репозитории проекта с описанием проблемы
3. Приложите логи ошибок и информацию о системе
